{"version":3,"sources":["Calendar.tsx"],"names":["getPageComponent","interval","DayPage","WeekPage","MonthPage","Calendar","selectedDate","onDateSelect","onPageChange","currentDate","HeaderComponent","DayLabelComponent","DayComponent","WeekComponent","MonthComponent","theme","pageBuffer","minDate","maxDate","pageInterpolator","defaultPageInterpolator","simultaneousGestures","monthAnimCallbackNode","gesturesDisabled","animationConfig","weekStartsOn","pageInterval","ref","initialDateRef","Date","pagerRef","currentDateRef","currentPageRef","pageCallbackNode","minPageIndex","Infinity","differ","current","maxPageIndex","onPageChangeRef","fullThemeObj","DEFAULT_THEME","dayLabelDateFormat","headerDateFormat","fullThemeRef","fullTheme","updatedTheme","incrementPage","options","animated","decrementPage","setPage","date","page","isSameFn","diffFn","_onPageChange","pg","addFn","dateWithOffset","setDate","providerValue","referenceDate","pageInterpolatorInternal","params","Object","assign","undefined","AnimUpdater","initialMonthIndex","getMonth","initialDayOfMonth","getDate","getMonthFromPage","initialOffset","midweek","getMonthFromDay","daysElapsedAtMonthStart","monthAnim","value","rawVal","modVal","React","memo","forwardRef","numDaysInMonth","Array","fill","flatMap","d","i","month","setMonth","reduce","acc","cur","last","length","push","dayOfYearToMonthIndex","monthIndex","map","_","pct","dayOfYear","floor","Math","remainder"],"mappings":"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","sourcesContent":["import React, {\n  useMemo,\n  useRef,\n  useEffect,\n  useImperativeHandle,\n  useCallback,\n} from \"react\";\nimport { isEqual } from \"lodash\";\nimport InfinitePager, {\n  InfinitePagerImperativeApi,\n  PageInterpolatorParams,\n} from \"react-native-infinite-pager\";\nimport { defaultPageInterpolator, DEFAULT_THEME } from \"./defaults\";\nimport {\n  CalendarImperativeApi,\n  CalendarProps,\n  ImperativeApiOptions,\n  PageInterval,\n} from \"./types\";\nimport { CalendarContext } from \"./context\";\nimport { MonthPage } from \"./Month\";\nimport Animated, {\n  useDerivedValue,\n  useSharedValue,\n} from \"react-native-reanimated\";\nimport {\n  getAddFn,\n  getDayLabelDateFormat,\n  getDiffFn,\n  getHeaderDateFormat,\n  getIsSameFn,\n} from \"./utils\";\nimport { WeekPage } from \"./Week\";\nimport { DayPage } from \"./Day\";\nimport { getDaysInMonth } from \"date-fns\";\n\nfunction getPageComponent(interval: PageInterval) {\n  switch (interval) {\n    case \"day\":\n      return DayPage;\n    case \"week\":\n      return WeekPage;\n    case \"month\":\n      return MonthPage;\n  }\n}\n\nfunction Calendar(\n  {\n    selectedDate,\n    onDateSelect,\n    onPageChange,\n    currentDate,\n    HeaderComponent,\n    DayLabelComponent,\n    DayComponent,\n    WeekComponent,\n    MonthComponent,\n    theme = {},\n    pageBuffer = 1,\n    minDate,\n    maxDate,\n    pageInterpolator = defaultPageInterpolator,\n    simultaneousGestures,\n    monthAnimCallbackNode,\n    gesturesDisabled,\n    animationConfig,\n    weekStartsOn = 0, // Sunday is default week start\n    pageInterval = \"month\",\n  }: CalendarProps,\n  ref: React.ForwardedRef<CalendarImperativeApi>\n) {\n  const initialDateRef = useRef(currentDate || new Date());\n  const pagerRef = useRef<InfinitePagerImperativeApi>(null);\n  const currentDateRef = useRef(currentDate);\n  const currentPageRef = useRef(0);\n\n  const pageCallbackNode = useSharedValue(0);\n\n  const minPageIndex = useMemo(() => {\n    if (!minDate) return -Infinity;\n    const differ = getDiffFn(pageInterval);\n    return differ(initialDateRef.current, minDate) * -1;\n  }, [minDate, pageInterval]);\n\n  const maxPageIndex = useMemo(() => {\n    if (!maxDate) return Infinity;\n    const differ = getDiffFn(pageInterval);\n    return differ(initialDateRef.current, maxDate) * -1;\n  }, [maxDate, pageInterval]);\n\n  const onPageChangeRef = useRef(onPageChange);\n  onPageChangeRef.current = onPageChange;\n\n  const fullThemeObj = {\n    ...DEFAULT_THEME,\n    dayLabelDateFormat: getDayLabelDateFormat(pageInterval),\n    headerDateFormat: getHeaderDateFormat(pageInterval),\n    ...theme,\n  };\n  const fullThemeRef = useRef(fullThemeObj);\n\n  const fullTheme: typeof DEFAULT_THEME = useMemo(() => {\n    const updatedTheme = { ...fullThemeRef.current, ...theme };\n    // If the theme object is defined inline, we only want to trigger context updates\n    // if the values contained actually change.\n    if (isEqual(fullThemeRef.current, updatedTheme)) {\n      return fullThemeRef.current;\n    } else {\n      fullThemeRef.current = updatedTheme;\n      return updatedTheme;\n    }\n  }, [theme]);\n\n  useImperativeHandle(\n    ref,\n    () => ({\n      incrementPage: (options?: ImperativeApiOptions) => {\n        const animated = options?.animated ?? true;\n        pagerRef.current?.incrementPage({ animated });\n      },\n      decrementPage: (options?: ImperativeApiOptions) => {\n        const animated = options?.animated ?? true;\n        pagerRef.current?.decrementPage({ animated });\n      },\n      setPage: (date: Date, options?: ImperativeApiOptions) => {\n        const animated = options?.animated ?? false;\n        const differ = getDiffFn(pageInterval);\n        const page = differ(date, initialDateRef.current);\n        pagerRef.current?.setPage(page, { animated });\n      },\n    }),\n    [pageInterval]\n  );\n\n  useEffect(() => {\n    // Hard set the page if the passed-in currentDate changes and the calendar isn't already displaying that month.\n\n    const isSameFn = getIsSameFn(pageInterval);\n    const diffFn = getDiffFn(pageInterval);\n    if (\n      currentDate &&\n      currentDateRef.current &&\n      !isSameFn(currentDate, currentDateRef.current)\n    ) {\n      const page = diffFn(currentDate, initialDateRef.current);\n      if (page === currentPageRef.current) return;\n      pagerRef.current?.setPage(page, { animated: false });\n    }\n\n    currentDateRef.current = currentDate;\n  }, [currentDate, pageInterval]);\n\n  const _onPageChange = useCallback(\n    (pg: number) => {\n      currentPageRef.current = pg;\n      const addFn = getAddFn(pageInterval);\n      const dateWithOffset = addFn(initialDateRef.current, pg);\n      dateWithOffset.setDate(1);\n      onPageChangeRef.current?.(dateWithOffset);\n    },\n    [pageInterval]\n  );\n\n  const providerValue = useMemo(\n    () => ({\n      referenceDate: initialDateRef.current,\n      selectedDate,\n      onDateSelect,\n      HeaderComponent,\n      DayLabelComponent,\n      DayComponent,\n      WeekComponent,\n      MonthComponent,\n      theme: fullTheme,\n      pageInterpolator,\n      weekStartsOn,\n    }),\n    [\n      selectedDate,\n      onDateSelect,\n      HeaderComponent,\n      DayLabelComponent,\n      DayComponent,\n      WeekComponent,\n      MonthComponent,\n      fullTheme,\n      pageInterpolator,\n      weekStartsOn,\n    ]\n  );\n\n  const pageInterpolatorInternal = useCallback(\n    (params: PageInterpolatorParams) => {\n      \"worklet\";\n      return pageInterpolator(Object.assign({}, params, { theme: fullTheme }));\n    },\n    [fullTheme, pageInterpolator]\n  );\n\n  return (\n    <CalendarContext.Provider value={providerValue}>\n      <InfinitePager\n        ref={pagerRef}\n        PageComponent={getPageComponent(pageInterval)}\n        pageBuffer={pageBuffer}\n        onPageChange={_onPageChange}\n        minIndex={minPageIndex}\n        maxIndex={maxPageIndex}\n        pageInterpolator={pageInterpolatorInternal}\n        simultaneousGestures={simultaneousGestures}\n        pageCallbackNode={monthAnimCallbackNode ? pageCallbackNode : undefined}\n        gesturesDisabled={gesturesDisabled}\n        animationConfig={animationConfig}\n      />\n      {monthAnimCallbackNode && (\n        <AnimUpdater\n          pageInterval={pageInterval}\n          initialDateRef={initialDateRef}\n          monthAnimCallbackNode={monthAnimCallbackNode}\n          pageCallbackNode={pageCallbackNode}\n        />\n      )}\n    </CalendarContext.Provider>\n  );\n}\n\n// Separate updater component so we only take the (slight) performance hit if the user provides a callback node\nfunction AnimUpdater({\n  initialDateRef,\n  pageCallbackNode,\n  monthAnimCallbackNode,\n  pageInterval,\n}: {\n  initialDateRef: React.MutableRefObject<Date>;\n  pageCallbackNode: Animated.SharedValue<number>;\n  monthAnimCallbackNode: Animated.SharedValue<number>;\n  pageInterval: PageInterval;\n}) {\n  const initialMonthIndex = initialDateRef.current.getMonth();\n  const initialDayOfMonth = initialDateRef.current.getDate();\n\n  useDerivedValue(() => {\n    function getMonthFromPage(page: number, initialOffset: number) {\n      switch (pageInterval) {\n        case \"week\": {\n          const midweek = page * 7 + 3.5 + initialOffset;\n          return getMonthFromDay(midweek);\n        }\n        case \"day\": {\n          return getMonthFromDay(page + initialOffset);\n        }\n        case \"month\":\n          // In 'month' view the pages already map to months\n          return page;\n      }\n    }\n\n    const initialOffset =\n      daysElapsedAtMonthStart[initialMonthIndex] + initialDayOfMonth;\n    const monthAnim = getMonthFromPage(pageCallbackNode.value, initialOffset);\n    const rawVal = monthAnim;\n    let modVal = rawVal % 12;\n    if (modVal < 0) {\n      modVal = 12 + modVal;\n    }\n    monthAnimCallbackNode.value = modVal;\n  }, [\n    pageCallbackNode,\n    monthAnimCallbackNode,\n    initialMonthIndex,\n    initialDayOfMonth,\n    pageInterval,\n  ]);\n\n  return null;\n}\n\nexport default React.memo(React.forwardRef(Calendar));\n\nconst numDaysInMonth = [...Array(12)].fill(0).flatMap((d, i) => {\n  const month = new Date();\n  month.setMonth(i);\n  const numDaysInMonth = getDaysInMonth(month);\n  return numDaysInMonth;\n});\n\nconst daysElapsedAtMonthStart = numDaysInMonth.reduce(\n  (acc, cur) => {\n    const last = acc[acc.length - 1] || 0;\n    acc.push(last + cur);\n    return acc;\n  },\n  [0]\n);\n\nconst dayOfYearToMonthIndex = numDaysInMonth.flatMap(\n  (numDaysInMonth, monthIndex) => {\n    return [...new Array(numDaysInMonth)].fill(0).map((_, i) => {\n      return {\n        pct: monthIndex + i / numDaysInMonth,\n        numDaysInMonth,\n      };\n    });\n  }\n);\n\nfunction getMonthFromDay(dayOfYear: number) {\n  \"worklet\";\n  const floor = Math.floor(dayOfYear);\n  const remainder = dayOfYear % 1;\n  const { pct, numDaysInMonth } = dayOfYearToMonthIndex[floor % 365];\n  return pct + remainder / numDaysInMonth;\n}\n"]}