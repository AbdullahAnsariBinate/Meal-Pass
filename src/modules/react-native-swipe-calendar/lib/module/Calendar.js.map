{"version":3,"sources":["Calendar.tsx"],"names":["React","useMemo","useRef","useEffect","useImperativeHandle","useCallback","isEqual","InfinitePager","defaultPageInterpolator","DEFAULT_THEME","CalendarContext","MonthPage","useDerivedValue","useSharedValue","getAddFn","getDayLabelDateFormat","getDiffFn","getHeaderDateFormat","getIsSameFn","WeekPage","DayPage","getDaysInMonth","getPageComponent","interval","Calendar","selectedDate","onDateSelect","onPageChange","currentDate","HeaderComponent","DayLabelComponent","DayComponent","WeekComponent","MonthComponent","theme","pageBuffer","minDate","maxDate","pageInterpolator","simultaneousGestures","monthAnimCallbackNode","gesturesDisabled","animationConfig","weekStartsOn","pageInterval","ref","initialDateRef","Date","pagerRef","currentDateRef","currentPageRef","pageCallbackNode","minPageIndex","Infinity","differ","current","maxPageIndex","onPageChangeRef","fullThemeObj","dayLabelDateFormat","headerDateFormat","fullThemeRef","fullTheme","updatedTheme","incrementPage","options","animated","decrementPage","setPage","date","page","isSameFn","diffFn","_onPageChange","pg","addFn","dateWithOffset","setDate","providerValue","referenceDate","pageInterpolatorInternal","params","Object","assign","undefined","AnimUpdater","initialMonthIndex","getMonth","initialDayOfMonth","getDate","getMonthFromPage","initialOffset","midweek","getMonthFromDay","daysElapsedAtMonthStart","monthAnim","value","rawVal","modVal","memo","forwardRef","numDaysInMonth","Array","fill","flatMap","d","i","month","setMonth","reduce","acc","cur","last","length","push","dayOfYearToMonthIndex","monthIndex","map","_","pct","dayOfYear","floor","Math","remainder"],"mappings":"AAAA,OAAOA,KAAP,IACEC,OADF,EAEEC,MAFF,EAGEC,SAHF,EAIEC,mBAJF,EAKEC,WALF,QAMO,OANP;AAOA,SAASC,OAAT,QAAwB,QAAxB;AACA,OAAOC,aAAP,MAGO,6BAHP;AAIA,SAASC,uBAAT,EAAkCC,aAAlC,QAAuD,YAAvD;AAOA,SAASC,eAAT,QAAgC,WAAhC;AACA,SAASC,SAAT,QAA0B,SAA1B;AACA,SACEC,eADF,EAEEC,cAFF,QAGO,yBAHP;AAIA,SACEC,QADF,EAEEC,qBAFF,EAGEC,SAHF,EAIEC,mBAJF,EAKEC,WALF,QAMO,SANP;AAOA,SAASC,QAAT,QAAyB,QAAzB;AACA,SAASC,OAAT,QAAwB,OAAxB;AACA,SAASC,cAAT,QAA+B,UAA/B;;AAEA,SAASC,gBAAT,CAA0BC,QAA1B,EAAkD;AAChD,UAAQA,QAAR;AACE,SAAK,KAAL;AACE,aAAOH,OAAP;;AACF,SAAK,MAAL;AACE,aAAOD,QAAP;;AACF,SAAK,OAAL;AACE,aAAOR,SAAP;AANJ;AAQD;;AAED,SAASa,QAAT,CACE;AACEC,EAAAA,YADF;AAEEC,EAAAA,YAFF;AAGEC,EAAAA,YAHF;AAIEC,EAAAA,WAJF;AAKEC,EAAAA,eALF;AAMEC,EAAAA,iBANF;AAOEC,EAAAA,YAPF;AAQEC,EAAAA,aARF;AASEC,EAAAA,cATF;AAUEC,EAAAA,KAAK,GAAG,EAVV;AAWEC,EAAAA,UAAU,GAAG,CAXf;AAYEC,EAAAA,OAZF;AAaEC,EAAAA,OAbF;AAcEC,EAAAA,gBAAgB,GAAG9B,uBAdrB;AAeE+B,EAAAA,oBAfF;AAgBEC,EAAAA,qBAhBF;AAiBEC,EAAAA,gBAjBF;AAkBEC,EAAAA,eAlBF;AAmBEC,EAAAA,YAAY,GAAG,CAnBjB;AAmBoB;AAClBC,EAAAA,YAAY,GAAG;AApBjB,CADF,EAuBEC,GAvBF,EAwBE;AACA,QAAMC,cAAc,GAAG5C,MAAM,CAAC0B,WAAW,IAAI,IAAImB,IAAJ,EAAhB,CAA7B;AACA,QAAMC,QAAQ,GAAG9C,MAAM,CAA6B,IAA7B,CAAvB;AACA,QAAM+C,cAAc,GAAG/C,MAAM,CAAC0B,WAAD,CAA7B;AACA,QAAMsB,cAAc,GAAGhD,MAAM,CAAC,CAAD,CAA7B;AAEA,QAAMiD,gBAAgB,GAAGtC,cAAc,CAAC,CAAD,CAAvC;AAEA,QAAMuC,YAAY,GAAGnD,OAAO,CAAC,MAAM;AACjC,QAAI,CAACmC,OAAL,EAAc,OAAO,CAACiB,QAAR;AACd,UAAMC,MAAM,GAAGtC,SAAS,CAAC4B,YAAD,CAAxB;AACA,WAAOU,MAAM,CAACR,cAAc,CAACS,OAAhB,EAAyBnB,OAAzB,CAAN,GAA0C,CAAC,CAAlD;AACD,GAJ2B,EAIzB,CAACA,OAAD,EAAUQ,YAAV,CAJyB,CAA5B;AAMA,QAAMY,YAAY,GAAGvD,OAAO,CAAC,MAAM;AACjC,QAAI,CAACoC,OAAL,EAAc,OAAOgB,QAAP;AACd,UAAMC,MAAM,GAAGtC,SAAS,CAAC4B,YAAD,CAAxB;AACA,WAAOU,MAAM,CAACR,cAAc,CAACS,OAAhB,EAAyBlB,OAAzB,CAAN,GAA0C,CAAC,CAAlD;AACD,GAJ2B,EAIzB,CAACA,OAAD,EAAUO,YAAV,CAJyB,CAA5B;AAMA,QAAMa,eAAe,GAAGvD,MAAM,CAACyB,YAAD,CAA9B;AACA8B,EAAAA,eAAe,CAACF,OAAhB,GAA0B5B,YAA1B;AAEA,QAAM+B,YAAY,GAAG,EACnB,GAAGjD,aADgB;AAEnBkD,IAAAA,kBAAkB,EAAE5C,qBAAqB,CAAC6B,YAAD,CAFtB;AAGnBgB,IAAAA,gBAAgB,EAAE3C,mBAAmB,CAAC2B,YAAD,CAHlB;AAInB,OAAGV;AAJgB,GAArB;AAMA,QAAM2B,YAAY,GAAG3D,MAAM,CAACwD,YAAD,CAA3B;AAEA,QAAMI,SAA+B,GAAG7D,OAAO,CAAC,MAAM;AACpD,UAAM8D,YAAY,GAAG,EAAE,GAAGF,YAAY,CAACN,OAAlB;AAA2B,SAAGrB;AAA9B,KAArB,CADoD,CAEpD;AACA;;AACA,QAAI5B,OAAO,CAACuD,YAAY,CAACN,OAAd,EAAuBQ,YAAvB,CAAX,EAAiD;AAC/C,aAAOF,YAAY,CAACN,OAApB;AACD,KAFD,MAEO;AACLM,MAAAA,YAAY,CAACN,OAAb,GAAuBQ,YAAvB;AACA,aAAOA,YAAP;AACD;AACF,GAV8C,EAU5C,CAAC7B,KAAD,CAV4C,CAA/C;AAYA9B,EAAAA,mBAAmB,CACjByC,GADiB,EAEjB,OAAO;AACLmB,IAAAA,aAAa,EAAGC,OAAD,IAAoC;AAAA;;AACjD,YAAMC,QAAQ,wBAAGD,OAAH,aAAGA,OAAH,uBAAGA,OAAO,CAAEC,QAAZ,iEAAwB,IAAtC;AACA,2BAAAlB,QAAQ,CAACO,OAAT,wEAAkBS,aAAlB,CAAgC;AAAEE,QAAAA;AAAF,OAAhC;AACD,KAJI;AAKLC,IAAAA,aAAa,EAAGF,OAAD,IAAoC;AAAA;;AACjD,YAAMC,QAAQ,yBAAGD,OAAH,aAAGA,OAAH,uBAAGA,OAAO,CAAEC,QAAZ,mEAAwB,IAAtC;AACA,4BAAAlB,QAAQ,CAACO,OAAT,0EAAkBY,aAAlB,CAAgC;AAAED,QAAAA;AAAF,OAAhC;AACD,KARI;AASLE,IAAAA,OAAO,EAAE,CAACC,IAAD,EAAaJ,OAAb,KAAgD;AAAA;;AACvD,YAAMC,QAAQ,yBAAGD,OAAH,aAAGA,OAAH,uBAAGA,OAAO,CAAEC,QAAZ,mEAAwB,KAAtC;AACA,YAAMZ,MAAM,GAAGtC,SAAS,CAAC4B,YAAD,CAAxB;AACA,YAAM0B,IAAI,GAAGhB,MAAM,CAACe,IAAD,EAAOvB,cAAc,CAACS,OAAtB,CAAnB;AACA,4BAAAP,QAAQ,CAACO,OAAT,0EAAkBa,OAAlB,CAA0BE,IAA1B,EAAgC;AAAEJ,QAAAA;AAAF,OAAhC;AACD;AAdI,GAAP,CAFiB,EAkBjB,CAACtB,YAAD,CAlBiB,CAAnB;AAqBAzC,EAAAA,SAAS,CAAC,MAAM;AACd;AAEA,UAAMoE,QAAQ,GAAGrD,WAAW,CAAC0B,YAAD,CAA5B;AACA,UAAM4B,MAAM,GAAGxD,SAAS,CAAC4B,YAAD,CAAxB;;AACA,QACEhB,WAAW,IACXqB,cAAc,CAACM,OADf,IAEA,CAACgB,QAAQ,CAAC3C,WAAD,EAAcqB,cAAc,CAACM,OAA7B,CAHX,EAIE;AAAA;;AACA,YAAMe,IAAI,GAAGE,MAAM,CAAC5C,WAAD,EAAckB,cAAc,CAACS,OAA7B,CAAnB;AACA,UAAIe,IAAI,KAAKpB,cAAc,CAACK,OAA5B,EAAqC;AACrC,4BAAAP,QAAQ,CAACO,OAAT,0EAAkBa,OAAlB,CAA0BE,IAA1B,EAAgC;AAAEJ,QAAAA,QAAQ,EAAE;AAAZ,OAAhC;AACD;;AAEDjB,IAAAA,cAAc,CAACM,OAAf,GAAyB3B,WAAzB;AACD,GAhBQ,EAgBN,CAACA,WAAD,EAAcgB,YAAd,CAhBM,CAAT;;AAkBA,QAAM6B,aAAa,GAAGpE,WAAW,CAC9BqE,EAAD,IAAgB;AAAA;;AACdxB,IAAAA,cAAc,CAACK,OAAf,GAAyBmB,EAAzB;AACA,UAAMC,KAAK,GAAG7D,QAAQ,CAAC8B,YAAD,CAAtB;AACA,UAAMgC,cAAc,GAAGD,KAAK,CAAC7B,cAAc,CAACS,OAAhB,EAAyBmB,EAAzB,CAA5B;AACAE,IAAAA,cAAc,CAACC,OAAf,CAAuB,CAAvB;AACA,6BAAApB,eAAe,CAACF,OAAhB,qFAAAE,eAAe,EAAWmB,cAAX,CAAf;AACD,GAP8B,EAQ/B,CAAChC,YAAD,CAR+B,CAAjC;;AAWA,QAAMkC,aAAa,GAAG7E,OAAO,CAC3B,OAAO;AACL8E,IAAAA,aAAa,EAAEjC,cAAc,CAACS,OADzB;AAEL9B,IAAAA,YAFK;AAGLC,IAAAA,YAHK;AAILG,IAAAA,eAJK;AAKLC,IAAAA,iBALK;AAMLC,IAAAA,YANK;AAOLC,IAAAA,aAPK;AAQLC,IAAAA,cARK;AASLC,IAAAA,KAAK,EAAE4B,SATF;AAULxB,IAAAA,gBAVK;AAWLK,IAAAA;AAXK,GAAP,CAD2B,EAc3B,CACElB,YADF,EAEEC,YAFF,EAGEG,eAHF,EAIEC,iBAJF,EAKEC,YALF,EAMEC,aANF,EAOEC,cAPF,EAQE6B,SARF,EASExB,gBATF,EAUEK,YAVF,CAd2B,CAA7B;AA4BA,QAAMqC,wBAAwB,GAAG3E,WAAW,CACzC4E,MAAD,IAAoC;AAClC;;AACA,WAAO3C,gBAAgB,CAAC4C,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkBF,MAAlB,EAA0B;AAAE/C,MAAAA,KAAK,EAAE4B;AAAT,KAA1B,CAAD,CAAvB;AACD,GAJyC,EAK1C,CAACA,SAAD,EAAYxB,gBAAZ,CAL0C,CAA5C;AAQA,sBACE,oBAAC,eAAD,CAAiB,QAAjB;AAA0B,IAAA,KAAK,EAAEwC;AAAjC,kBACE,oBAAC,aAAD;AACE,IAAA,GAAG,EAAE9B,QADP;AAEE,IAAA,aAAa,EAAE1B,gBAAgB,CAACsB,YAAD,CAFjC;AAGE,IAAA,UAAU,EAAET,UAHd;AAIE,IAAA,YAAY,EAAEsC,aAJhB;AAKE,IAAA,QAAQ,EAAErB,YALZ;AAME,IAAA,QAAQ,EAAEI,YANZ;AAOE,IAAA,gBAAgB,EAAEwB,wBAPpB;AAQE,IAAA,oBAAoB,EAAEzC,oBARxB;AASE,IAAA,gBAAgB,EAAEC,qBAAqB,GAAGW,gBAAH,GAAsBiC,SAT/D;AAUE,IAAA,gBAAgB,EAAE3C,gBAVpB;AAWE,IAAA,eAAe,EAAEC;AAXnB,IADF,EAcGF,qBAAqB,iBACpB,oBAAC,WAAD;AACE,IAAA,YAAY,EAAEI,YADhB;AAEE,IAAA,cAAc,EAAEE,cAFlB;AAGE,IAAA,qBAAqB,EAAEN,qBAHzB;AAIE,IAAA,gBAAgB,EAAEW;AAJpB,IAfJ,CADF;AAyBD,C,CAED;;;AACA,SAASkC,WAAT,CAAqB;AACnBvC,EAAAA,cADmB;AAEnBK,EAAAA,gBAFmB;AAGnBX,EAAAA,qBAHmB;AAInBI,EAAAA;AAJmB,CAArB,EAUG;AACD,QAAM0C,iBAAiB,GAAGxC,cAAc,CAACS,OAAf,CAAuBgC,QAAvB,EAA1B;AACA,QAAMC,iBAAiB,GAAG1C,cAAc,CAACS,OAAf,CAAuBkC,OAAvB,EAA1B;AAEA7E,EAAAA,eAAe,CAAC,MAAM;AACpB,aAAS8E,gBAAT,CAA0BpB,IAA1B,EAAwCqB,aAAxC,EAA+D;AAC7D,cAAQ/C,YAAR;AACE,aAAK,MAAL;AAAa;AACX,kBAAMgD,OAAO,GAAGtB,IAAI,GAAG,CAAP,GAAW,GAAX,GAAiBqB,aAAjC;AACA,mBAAOE,eAAe,CAACD,OAAD,CAAtB;AACD;;AACD,aAAK,KAAL;AAAY;AACV,mBAAOC,eAAe,CAACvB,IAAI,GAAGqB,aAAR,CAAtB;AACD;;AACD,aAAK,OAAL;AACE;AACA,iBAAOrB,IAAP;AAVJ;AAYD;;AAED,UAAMqB,aAAa,GACjBG,uBAAuB,CAACR,iBAAD,CAAvB,GAA6CE,iBAD/C;AAEA,UAAMO,SAAS,GAAGL,gBAAgB,CAACvC,gBAAgB,CAAC6C,KAAlB,EAAyBL,aAAzB,CAAlC;AACA,UAAMM,MAAM,GAAGF,SAAf;AACA,QAAIG,MAAM,GAAGD,MAAM,GAAG,EAAtB;;AACA,QAAIC,MAAM,GAAG,CAAb,EAAgB;AACdA,MAAAA,MAAM,GAAG,KAAKA,MAAd;AACD;;AACD1D,IAAAA,qBAAqB,CAACwD,KAAtB,GAA8BE,MAA9B;AACD,GAzBc,EAyBZ,CACD/C,gBADC,EAEDX,qBAFC,EAGD8C,iBAHC,EAIDE,iBAJC,EAKD5C,YALC,CAzBY,CAAf;AAiCA,SAAO,IAAP;AACD;;AAED,4BAAe5C,KAAK,CAACmG,IAAN,eAAWnG,KAAK,CAACoG,UAAN,CAAiB5E,QAAjB,CAAX,CAAf;AAEA,MAAM6E,cAAc,GAAG,CAAC,GAAGC,KAAK,CAAC,EAAD,CAAT,EAAeC,IAAf,CAAoB,CAApB,EAAuBC,OAAvB,CAA+B,CAACC,CAAD,EAAIC,CAAJ,KAAU;AAC9D,QAAMC,KAAK,GAAG,IAAI5D,IAAJ,EAAd;AACA4D,EAAAA,KAAK,CAACC,QAAN,CAAeF,CAAf;AACA,QAAML,cAAc,GAAGhF,cAAc,CAACsF,KAAD,CAArC;AACA,SAAON,cAAP;AACD,CALsB,CAAvB;AAOA,MAAMP,uBAAuB,GAAGO,cAAc,CAACQ,MAAf,CAC9B,CAACC,GAAD,EAAMC,GAAN,KAAc;AACZ,QAAMC,IAAI,GAAGF,GAAG,CAACA,GAAG,CAACG,MAAJ,GAAa,CAAd,CAAH,IAAuB,CAApC;AACAH,EAAAA,GAAG,CAACI,IAAJ,CAASF,IAAI,GAAGD,GAAhB;AACA,SAAOD,GAAP;AACD,CAL6B,EAM9B,CAAC,CAAD,CAN8B,CAAhC;AASA,MAAMK,qBAAqB,GAAGd,cAAc,CAACG,OAAf,CAC5B,CAACH,cAAD,EAAiBe,UAAjB,KAAgC;AAC9B,SAAO,CAAC,GAAG,IAAId,KAAJ,CAAUD,cAAV,CAAJ,EAA+BE,IAA/B,CAAoC,CAApC,EAAuCc,GAAvC,CAA2C,CAACC,CAAD,EAAIZ,CAAJ,KAAU;AAC1D,WAAO;AACLa,MAAAA,GAAG,EAAEH,UAAU,GAAGV,CAAC,GAAGL,cADjB;AAELA,MAAAA;AAFK,KAAP;AAID,GALM,CAAP;AAMD,CAR2B,CAA9B;;AAWA,SAASR,eAAT,CAAyB2B,SAAzB,EAA4C;AAC1C;;AACA,QAAMC,KAAK,GAAGC,IAAI,CAACD,KAAL,CAAWD,SAAX,CAAd;AACA,QAAMG,SAAS,GAAGH,SAAS,GAAG,CAA9B;AACA,QAAM;AAAED,IAAAA,GAAF;AAAOlB,IAAAA;AAAP,MAA0Bc,qBAAqB,CAACM,KAAK,GAAG,GAAT,CAArD;AACA,SAAOF,GAAG,GAAGI,SAAS,GAAGtB,cAAzB;AACD","sourcesContent":["import React, {\n  useMemo,\n  useRef,\n  useEffect,\n  useImperativeHandle,\n  useCallback,\n} from \"react\";\nimport { isEqual } from \"lodash\";\nimport InfinitePager, {\n  InfinitePagerImperativeApi,\n  PageInterpolatorParams,\n} from \"react-native-infinite-pager\";\nimport { defaultPageInterpolator, DEFAULT_THEME } from \"./defaults\";\nimport {\n  CalendarImperativeApi,\n  CalendarProps,\n  ImperativeApiOptions,\n  PageInterval,\n} from \"./types\";\nimport { CalendarContext } from \"./context\";\nimport { MonthPage } from \"./Month\";\nimport Animated, {\n  useDerivedValue,\n  useSharedValue,\n} from \"react-native-reanimated\";\nimport {\n  getAddFn,\n  getDayLabelDateFormat,\n  getDiffFn,\n  getHeaderDateFormat,\n  getIsSameFn,\n} from \"./utils\";\nimport { WeekPage } from \"./Week\";\nimport { DayPage } from \"./Day\";\nimport { getDaysInMonth } from \"date-fns\";\n\nfunction getPageComponent(interval: PageInterval) {\n  switch (interval) {\n    case \"day\":\n      return DayPage;\n    case \"week\":\n      return WeekPage;\n    case \"month\":\n      return MonthPage;\n  }\n}\n\nfunction Calendar(\n  {\n    selectedDate,\n    onDateSelect,\n    onPageChange,\n    currentDate,\n    HeaderComponent,\n    DayLabelComponent,\n    DayComponent,\n    WeekComponent,\n    MonthComponent,\n    theme = {},\n    pageBuffer = 1,\n    minDate,\n    maxDate,\n    pageInterpolator = defaultPageInterpolator,\n    simultaneousGestures,\n    monthAnimCallbackNode,\n    gesturesDisabled,\n    animationConfig,\n    weekStartsOn = 0, // Sunday is default week start\n    pageInterval = \"month\",\n  }: CalendarProps,\n  ref: React.ForwardedRef<CalendarImperativeApi>\n) {\n  const initialDateRef = useRef(currentDate || new Date());\n  const pagerRef = useRef<InfinitePagerImperativeApi>(null);\n  const currentDateRef = useRef(currentDate);\n  const currentPageRef = useRef(0);\n\n  const pageCallbackNode = useSharedValue(0);\n\n  const minPageIndex = useMemo(() => {\n    if (!minDate) return -Infinity;\n    const differ = getDiffFn(pageInterval);\n    return differ(initialDateRef.current, minDate) * -1;\n  }, [minDate, pageInterval]);\n\n  const maxPageIndex = useMemo(() => {\n    if (!maxDate) return Infinity;\n    const differ = getDiffFn(pageInterval);\n    return differ(initialDateRef.current, maxDate) * -1;\n  }, [maxDate, pageInterval]);\n\n  const onPageChangeRef = useRef(onPageChange);\n  onPageChangeRef.current = onPageChange;\n\n  const fullThemeObj = {\n    ...DEFAULT_THEME,\n    dayLabelDateFormat: getDayLabelDateFormat(pageInterval),\n    headerDateFormat: getHeaderDateFormat(pageInterval),\n    ...theme,\n  };\n  const fullThemeRef = useRef(fullThemeObj);\n\n  const fullTheme: typeof DEFAULT_THEME = useMemo(() => {\n    const updatedTheme = { ...fullThemeRef.current, ...theme };\n    // If the theme object is defined inline, we only want to trigger context updates\n    // if the values contained actually change.\n    if (isEqual(fullThemeRef.current, updatedTheme)) {\n      return fullThemeRef.current;\n    } else {\n      fullThemeRef.current = updatedTheme;\n      return updatedTheme;\n    }\n  }, [theme]);\n\n  useImperativeHandle(\n    ref,\n    () => ({\n      incrementPage: (options?: ImperativeApiOptions) => {\n        const animated = options?.animated ?? true;\n        pagerRef.current?.incrementPage({ animated });\n      },\n      decrementPage: (options?: ImperativeApiOptions) => {\n        const animated = options?.animated ?? true;\n        pagerRef.current?.decrementPage({ animated });\n      },\n      setPage: (date: Date, options?: ImperativeApiOptions) => {\n        const animated = options?.animated ?? false;\n        const differ = getDiffFn(pageInterval);\n        const page = differ(date, initialDateRef.current);\n        pagerRef.current?.setPage(page, { animated });\n      },\n    }),\n    [pageInterval]\n  );\n\n  useEffect(() => {\n    // Hard set the page if the passed-in currentDate changes and the calendar isn't already displaying that month.\n\n    const isSameFn = getIsSameFn(pageInterval);\n    const diffFn = getDiffFn(pageInterval);\n    if (\n      currentDate &&\n      currentDateRef.current &&\n      !isSameFn(currentDate, currentDateRef.current)\n    ) {\n      const page = diffFn(currentDate, initialDateRef.current);\n      if (page === currentPageRef.current) return;\n      pagerRef.current?.setPage(page, { animated: false });\n    }\n\n    currentDateRef.current = currentDate;\n  }, [currentDate, pageInterval]);\n\n  const _onPageChange = useCallback(\n    (pg: number) => {\n      currentPageRef.current = pg;\n      const addFn = getAddFn(pageInterval);\n      const dateWithOffset = addFn(initialDateRef.current, pg);\n      dateWithOffset.setDate(1);\n      onPageChangeRef.current?.(dateWithOffset);\n    },\n    [pageInterval]\n  );\n\n  const providerValue = useMemo(\n    () => ({\n      referenceDate: initialDateRef.current,\n      selectedDate,\n      onDateSelect,\n      HeaderComponent,\n      DayLabelComponent,\n      DayComponent,\n      WeekComponent,\n      MonthComponent,\n      theme: fullTheme,\n      pageInterpolator,\n      weekStartsOn,\n    }),\n    [\n      selectedDate,\n      onDateSelect,\n      HeaderComponent,\n      DayLabelComponent,\n      DayComponent,\n      WeekComponent,\n      MonthComponent,\n      fullTheme,\n      pageInterpolator,\n      weekStartsOn,\n    ]\n  );\n\n  const pageInterpolatorInternal = useCallback(\n    (params: PageInterpolatorParams) => {\n      \"worklet\";\n      return pageInterpolator(Object.assign({}, params, { theme: fullTheme }));\n    },\n    [fullTheme, pageInterpolator]\n  );\n\n  return (\n    <CalendarContext.Provider value={providerValue}>\n      <InfinitePager\n        ref={pagerRef}\n        PageComponent={getPageComponent(pageInterval)}\n        pageBuffer={pageBuffer}\n        onPageChange={_onPageChange}\n        minIndex={minPageIndex}\n        maxIndex={maxPageIndex}\n        pageInterpolator={pageInterpolatorInternal}\n        simultaneousGestures={simultaneousGestures}\n        pageCallbackNode={monthAnimCallbackNode ? pageCallbackNode : undefined}\n        gesturesDisabled={gesturesDisabled}\n        animationConfig={animationConfig}\n      />\n      {monthAnimCallbackNode && (\n        <AnimUpdater\n          pageInterval={pageInterval}\n          initialDateRef={initialDateRef}\n          monthAnimCallbackNode={monthAnimCallbackNode}\n          pageCallbackNode={pageCallbackNode}\n        />\n      )}\n    </CalendarContext.Provider>\n  );\n}\n\n// Separate updater component so we only take the (slight) performance hit if the user provides a callback node\nfunction AnimUpdater({\n  initialDateRef,\n  pageCallbackNode,\n  monthAnimCallbackNode,\n  pageInterval,\n}: {\n  initialDateRef: React.MutableRefObject<Date>;\n  pageCallbackNode: Animated.SharedValue<number>;\n  monthAnimCallbackNode: Animated.SharedValue<number>;\n  pageInterval: PageInterval;\n}) {\n  const initialMonthIndex = initialDateRef.current.getMonth();\n  const initialDayOfMonth = initialDateRef.current.getDate();\n\n  useDerivedValue(() => {\n    function getMonthFromPage(page: number, initialOffset: number) {\n      switch (pageInterval) {\n        case \"week\": {\n          const midweek = page * 7 + 3.5 + initialOffset;\n          return getMonthFromDay(midweek);\n        }\n        case \"day\": {\n          return getMonthFromDay(page + initialOffset);\n        }\n        case \"month\":\n          // In 'month' view the pages already map to months\n          return page;\n      }\n    }\n\n    const initialOffset =\n      daysElapsedAtMonthStart[initialMonthIndex] + initialDayOfMonth;\n    const monthAnim = getMonthFromPage(pageCallbackNode.value, initialOffset);\n    const rawVal = monthAnim;\n    let modVal = rawVal % 12;\n    if (modVal < 0) {\n      modVal = 12 + modVal;\n    }\n    monthAnimCallbackNode.value = modVal;\n  }, [\n    pageCallbackNode,\n    monthAnimCallbackNode,\n    initialMonthIndex,\n    initialDayOfMonth,\n    pageInterval,\n  ]);\n\n  return null;\n}\n\nexport default React.memo(React.forwardRef(Calendar));\n\nconst numDaysInMonth = [...Array(12)].fill(0).flatMap((d, i) => {\n  const month = new Date();\n  month.setMonth(i);\n  const numDaysInMonth = getDaysInMonth(month);\n  return numDaysInMonth;\n});\n\nconst daysElapsedAtMonthStart = numDaysInMonth.reduce(\n  (acc, cur) => {\n    const last = acc[acc.length - 1] || 0;\n    acc.push(last + cur);\n    return acc;\n  },\n  [0]\n);\n\nconst dayOfYearToMonthIndex = numDaysInMonth.flatMap(\n  (numDaysInMonth, monthIndex) => {\n    return [...new Array(numDaysInMonth)].fill(0).map((_, i) => {\n      return {\n        pct: monthIndex + i / numDaysInMonth,\n        numDaysInMonth,\n      };\n    });\n  }\n);\n\nfunction getMonthFromDay(dayOfYear: number) {\n  \"worklet\";\n  const floor = Math.floor(dayOfYear);\n  const remainder = dayOfYear % 1;\n  const { pct, numDaysInMonth } = dayOfYearToMonthIndex[floor % 365];\n  return pct + remainder / numDaysInMonth;\n}\n"]}